<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>User's page</title>
    <script>
        var logout_url = "http://localhost:3000/logout";
        var get_login_url = "http://localhost:3000/get_login";
        var unsolved_url = "http://localhost:3000/unsolved/user";
        var solved_url = "http://localhost:3000/solved/user";

        function queryUnsolvedTable(request) {
            function reqListenerUnsolved(event) {
                var data = JSON.parse(this.responseText);
                var table = document.getElementById("unsolved-table")
                table.innerHTML='';
                if (data.length > 0) {
                    var hrow = table.insertRow();
                    var titleCell = hrow.insertCell();
                    titleCell.outerHTML = '<th>Title</th>';

                    var descriptionCell = hrow.insertCell();
                    descriptionCell.outerHTML = '<th>Description</th>';
                }
                for (var i = 0; i < data.length; i++) {
                    var newRow = table.insertRow();
                    var titleCell = newRow.insertCell();
                    titleCell.innerHTML = data[i]['title'];

                    var descriptionCell = newRow.insertCell();
                    descriptionCell.innerHTML = data[i]['description'];
                }
            }
            var oReq = new XMLHttpRequest();
            oReq.addEventListener('load', reqListenerUnsolved);
            oReq.open("GET", request);
            oReq.send();
        }

        function querySolvedTable(request) {
            function reqListenerSolved(event) {
                var data = JSON.parse(this.responseText);
                var table = document.getElementById("solved-table")
                table.innerHTML='';
                if (data.length > 0) {
                    var hrow = table.insertRow();
                    var titleCell = hrow.insertCell();
                    titleCell.outerHTML = '<th>Title</th>';

                    var descriptionCell = hrow.insertCell();
                    descriptionCell.outerHTML = '<th>Description</th>';

                    var noteCell = hrow.insertCell();
                    noteCell.outerHTML = '<th>Tech support note</th>';

                }
                for (var i = 0; i < data.length; i++) {
                    var newRow = table.insertRow();
                    var titleCell = newRow.insertCell();
                    titleCell.innerHTML = data[i]['title'];

                    var descriptionCell = newRow.insertCell();
                    descriptionCell.innerHTML = data[i]['description'];

                    var noteCell = newRow.insertCell();
                    noteCell.innerHTML = data[i]['note'];
                }
            }

            var oReq = new XMLHttpRequest();
            oReq.addEventListener('load', reqListenerSolved);
            oReq.open("GET", request);
            oReq.send();

        }

        function queryTables() {
            queryUnsolvedTable(unsolved_url);
            querySolvedTable(solved_url);
        }

        function setUsername(request) {
            console.log(request);

            function reqListenerUsername() {
                var data = JSON.parse(this.responseText);
                var username_span = document.getElementById("username");
                username_span.innerHTML = data['login'];
            }

            var oReq = new XMLHttpRequest();
            oReq.addEventListener('load', reqListenerUsername);
            oReq.open("GET", request);
            oReq.send();
        }

        document.addEventListener("DOMContentLoaded", queryTables());
        document.addEventListener("DOMContentLoaded", setUsername(get_login_url));
        
        function logout(request) {
            var oReq = new XMLHttpRequest();
            oReq.open("GET", request);
            oReq.onload = function() {
                window.location.href = '/auth';
            }
            oReq.send();
        }
    </script>
</head>
<body style="background-color: rgb(147, 161, 165);">
    <header style="text-align: right;">
        User: <span id="username"></span>
        <button onclick="logout(logout_url);"> <!-- TODO здесь надо перекинуть на auth.html при onclick -->
            log out
        </button>
    </header>
    <div id="form-container" style="width: fit-content; height: fit-content; margin: auto;text-align: center; font-weight: 700; font-size: 20px; padding-bottom: 5px;">
        <form method="post">
            <label for="problem-title">Problem title: </label>
            <br>
            <input type="text" id="problem-title" name="problemtitle" placeholder="Briefly describe your problem..." required>
            <br>
            <br>

            <label for="problem-description">Describe your problem: </label>
            <br>
            <textarea id="problem-description" name="problemdescription" required></textarea>
            <br>
            <br>

            <div id="button-container" style="text-align: center;">
                <button>
                    Submit
                </button>
            </div>
        </form>
    </div>
    <br>
    <br>
    <div id="unsolved-container">
        <div style="text-align: center; font-weight: 700; font-size: 20px; padding-bottom: 5px;">
            <label for="unsolved" style="margin: auto;">My unsolved problems list</label>
        </div>
        <table id="unsolved-table">
            <tr>
                <th>Title</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>Input doesn't work</td>
                <td>When i try to input smt it doesnt allow me to :(</td>
            </tr>
        </table>
    </div>
    <br>
    <br>
    <br>
    <br>
    <div id="solved-container">
        <div style="text-align: center; font-weight: 700; font-size: 20px; padding-bottom: 5px;">
            <label for="solved" style="margin: auto;">My solved problems list</label>
        </div>
        <table id="solved-table">
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Tech support's note</th>
            </tr>
            <tr>
                <td>Submit button doenst work</td>
                <td>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</td>
                <td>
                    
                </td>
            </tr>
        </table>
    </div>
    <!-- <div id="table-container" style="width: fit-content; height: fit-content; margin: auto;">
        <div style="text-align: center; font-weight: 700; font-size: 20px; padding-bottom: 5px;">
            <label for="problem-table" style="margin: auto;">Problems list</label>
        </div>

        <table id="problem-table">
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Author</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Input doesn't work</td>
                <td>When i try to input smt it doesnt allow me to :(</td>
                <td>Ivan Ivanov Ivanovich</td>
                <td class="unsolved">Unsolved</td>
            </tr>
            <tr>
                <td>Submit button doenst work</td>
                <td>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</td>
                <td>Ivan Petrov Ivanovich</td>
                <td class="solved">Solved</td>
            </tr>
        </table>
    </div>
-->
</body>
</html>